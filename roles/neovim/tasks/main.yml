- name: Assert HOME is set
  ansible.builtin.assert:
    that:
      - home_dir is defined
      - home_dir | length > 1
    fail_msg: "HOME is not set; cannot deploy Neovim config."

- name: Ensure ~/.config exists
  ansible.builtin.file:
    path: "{{ home_dir }}/.config"
    state: directory
    mode: "0755"

- name: Deploy Neovim config tree (files/nvim -> ~/.config/nvim)
  ansible.builtin.include_tasks: deploy_tree.yml

- name: Install/update Neovim plugins (headless)
  ansible.builtin.include_tasks: plugins.yml
